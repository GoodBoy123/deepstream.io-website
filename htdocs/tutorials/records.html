<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>deepstream.io | Records tutorial</title>

	<meta name="viewport" content="width=device-width, initial-scale=1" />

	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<meta name="keywords" content="deepstream, deepstream.io, streaming, realtime, server, socket" />
	<meta name="description" content="learn about records, deepstream&#x27;s observable data structures" />
	<meta name="author" content="Wolfram Hempel" />
	<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
	<link rel="icon" href="/favicon.ico" type="image/x-icon">
	<link rel="stylesheet" type="text/css" href="../assets/css/navigation.css" />
	<link rel="stylesheet" type="text/css" href="../assets/css/screen.css" />
	<script type="text/javascript">
	document.createElement( 'header' );
	document.createElement( 'nav' );
	</script>
	<script type="text/javascript" src="../assets/js/jquery.js"></script>
	<script type="text/javascript" src="../assets/js/menu.js"></script>

	<link href='http://fonts.googleapis.com/css?family=Montserrat' rel='stylesheet' type='text/css'>
	<link href='http://fonts.googleapis.com/css?family=Quicksand:300,400,700' rel='stylesheet' type='text/css'>
	<link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
</head>

<body class="category_D:\git\deepstream.io-website\pages\tutorials ">
	<div class="mobile-menu">
		<div class="nav mobile-nav">
			<ul>
				<li ><a href="..">Home</a></li>
				<li ><a href="../download/">Downloads</a></li>
				<li ><a href="../tutorials/getting-started.html">Tutorials</a></li>
				<li ><a href="../docs/deepstream.html">Documentation</a></li>
				<li ><a href="../blog/">Blog</a></li>
				<li ><a href="../info/">Info</a></li>				
			</ul>		</div>
	</div>

	<div id="outer-wrapper">
		<div id="header" class="compact-header">
			<div class="header-tiny-logo">
				<h1><a href="..">deepstream.io - a scalable server for realtime web apps</a></h1>
			</div>
			<div class="nav desktop-nav">
				<ul>
					<li ><a href="..">Home</a></li>
					<li ><a href="../download/">Downloads</a></li>
					<li ><a href="../tutorials/getting-started.html">Tutorials</a></li>
					<li ><a href="../docs/deepstream.html">Documentation</a></li>
					<li ><a href="../blog/">Blog</a></li>
					<li ><a href="../info/">Info</a></li>				
				</ul>			</div>
			<span class="menu-button menu-icon">
				<i class="fa fa-bars"></i>
			</span>
		</div>
			<div class="content main">
				<h1>Records</h1><p><a href="docs/record.html">Records</a> are arbitrary JSON structures that can be manipulated and subscribed to. Every change to a record is synced accross all subscribed clients</p><pre><code><span class="token comment" spellcheck="true">//creating or retrieving a record is the same
</span><span class="token keyword" >var</span> johnDoe <span class="token operator" >=</span> ds<span class="token punctuation" >.</span>record<span class="token punctuation" >.</span><span class="token function" >getRecord<span class="token punctuation" >(</span></span> <span class="token string" >'johnDoe'</span> <span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token comment" spellcheck="true">
//you can set the entire record's content
</span>johnDoe<span class="token punctuation" >.</span><span class="token keyword" >set</span><span class="token punctuation" >(</span><span class="token punctuation" >{</span> firstname<span class="token punctuation" >:</span> <span class="token string" >'John'</span><span class="token punctuation" >,</span> lastname<span class="token punctuation" >:</span> <span class="token string" >'Doe'</span> <span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token comment" spellcheck="true">
//or just a path within the record
</span>johnDoe<span class="token punctuation" >.</span><span class="token keyword" >set</span><span class="token punctuation" >(</span> <span class="token string" >'age'</span><span class="token punctuation" >,</span> <span class="token number" >28</span> <span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token comment" spellcheck="true">
//getting data from a record works the same
</span>johnDoe<span class="token punctuation" >.</span><span class="token keyword" >get</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token comment" spellcheck="true">
//but be aware, if your record exists already
</span><span class="token comment" spellcheck="true">//it needs a brief moment to receive its data
</span>johnDoe<span class="token punctuation" >.</span><span class="token function" >whenReady<span class="token punctuation" >(</span></span><span class="token keyword" >function</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >{</span>
    <span class="token function" >alert<span class="token punctuation" >(</span></span> johnDoe<span class="token punctuation" >.</span><span class="token keyword" >get</span><span class="token punctuation" >(</span> <span class="token string" >'middleName'</span> <span class="token punctuation" >)</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token comment" spellcheck="true">
//or if you just want to get the value of a
</span><span class="token comment" spellcheck="true">//specific path
</span>johnDoe<span class="token punctuation" >.</span><span class="token keyword" >get</span><span class="token punctuation" >(</span> <span class="token string" >'firstname'</span> <span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token comment" spellcheck="true">
//paths can be as complex as you like. If you
</span><span class="token comment" spellcheck="true">//set a value for a path that doesn't exist yet,
</span><span class="token comment" spellcheck="true">//deepstream will create it
</span>johnDoe<span class="token punctuation" >.</span><span class="token keyword" >set</span><span class="token punctuation" >(</span> <span class="token string" >'hobbies[2].name'</span><span class="token punctuation" >,</span> <span class="token string" >'skiing'</span> <span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token comment" spellcheck="true">
//you can subscribe to changes of the entire record...
</span>johnDoe<span class="token punctuation" >.</span><span class="token function" >subscribe<span class="token punctuation" >(</span></span><span class="token keyword" >function</span><span class="token punctuation" >(</span> data <span class="token punctuation" >)</span><span class="token punctuation" >{</span> <span class="token comment" spellcheck="true">/*...*/</span> <span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token comment" spellcheck="true">
//or just the changes of a specific field
</span><span class="token keyword" >var</span> happyBirthday <span class="token operator" >=</span> <span class="token keyword" >function</span><span class="token punctuation" >(</span> newAge <span class="token punctuation" >)</span><span class="token punctuation" >{</span> <span class="token function" >alert<span class="token punctuation" >(</span></span> <span class="token string" >'Happy birthday'</span> <span class="token punctuation" >)</span><span class="token punctuation" >;</span><span class="token punctuation" >}</span><span class="token punctuation" >;</span>
johnDoe<span class="token punctuation" >.</span><span class="token function" >subscribe<span class="token punctuation" >(</span></span> <span class="token string" >'age'</span><span class="token punctuation" >,</span> happyBirthday <span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token comment" spellcheck="true">
//You can remove subscriptions
</span>johnDoe<span class="token punctuation" >.</span><span class="token function" >unsubscribe<span class="token punctuation" >(</span></span> <span class="token string" >'age'</span><span class="token punctuation" >,</span> happyBirthday <span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token comment" spellcheck="true">
//records also emit events
</span>johnDoe<span class="token punctuation" >.</span><span class="token function" >on<span class="token punctuation" >(</span></span> <span class="token string" >'delete'</span><span class="token punctuation" >,</span> <span class="token keyword" >function</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >{</span>
    <span class="token function" >alert<span class="token punctuation" >(</span></span> <span class="token string" >'someone deleted this record'</span> <span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token comment" spellcheck="true">
//Once you are no longer interested in receiving
</span><span class="token comment" spellcheck="true">//updates for this record, call discard
</span>johnDoe<span class="token punctuation" >.</span><span class="token function" >discard<span class="token punctuation" >(</span></span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token comment" spellcheck="true">
//Or delete the record entirely
</span>johnDoe<span class="token punctuation" >.</span><span class="token keyword" >delete</span><span class="token punctuation" >(</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
</code></pre><p>###Record names
Every record is identified by a unique name. This name can be any string, but we found that there are some naming conventions that help a lot with larger scale applications:</p><p>####Use unique, randomized ids
It&#39;s tempting to use a field that could act as primary key as the recordname, e.g. <code>user/johndoe</code>, but using a UID, e.g. <code>user/iam7f3vy-2mgd656jrx3di</code> has some advantages: You don&#39;t need to ensure its uniqueness, the user can change his username later without invalidating the record and ids generated with deepstream&#39;s <code>ds.getUid()</code> method are loosely sequential (the first 8 characters are a base64 encoded) which helps databases to index them more efficiently.</p><p>####Organize your records into collections
Prefixing your record names with a collection, e.g. <code>user/bob</code> rather than just <code>bob</code> makes them easier to organize and allows storage-connectors to create individual database tables or collections for each.</p><p>####Use a security group to support permissioning
If your system has to support multiple users or groups that are not allowed to access each others data, it might make sense to include the id of the group into the record name. This allows the permissionHandler to deny access to records straight away if they don&#39;t belong to the user&#39;s group.</p><p><strong>Client</strong></p><pre><code><span class="token keyword" >var</span> ds <span class="token operator" >=</span> <span class="token function" >deepstream<span class="token punctuation" >(</span></span> <span class="token string" >'143.234.324.234:6020'</span> <span class="token punctuation" >)</span><span class="token punctuation" >;</span>
ds<span class="token punctuation" >.</span><span class="token function" >login<span class="token punctuation" >(</span></span><span class="token punctuation" >{</span> user<span class="token punctuation" >:</span> <span class="token string" >'paul'</span><span class="token punctuation" >,</span> pass<span class="token punctuation" >:</span> <span class="token string" >'abc'</span> <span class="token punctuation" >}</span><span class="token punctuation" >,</span> <span class="token keyword" >function</span><span class="token punctuation" >(</span> success <span class="token punctuation" >)</span><span class="token punctuation" >{</span>
    <span class="token keyword" >if</span><span class="token punctuation" >(</span> success <span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
       <span class="token comment" spellcheck="true"> //Allowed
</span>        <span class="token keyword" >var</span> recA <span class="token operator" >=</span> ds<span class="token punctuation" >.</span>record<span class="token punctuation" >.</span><span class="token function" >getRecord<span class="token punctuation" >(</span></span> <span class="token string" >'beatles-albums'</span> <span class="token punctuation" >)</span><span class="token punctuation" >;</span>
       <span class="token comment" spellcheck="true"> //Forbidden
</span>        <span class="token keyword" >var</span> recB <span class="token operator" >=</span> ds<span class="token punctuation" >.</span>record<span class="token punctuation" >.</span><span class="token function" >getRecord<span class="token punctuation" >(</span></span> <span class="token string" >'stones-albums'</span> <span class="token punctuation" >)</span><span class="token punctuation" >;</span>
    <span class="token punctuation" >}</span>
<span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
</code></pre><p><strong>Server</strong></p><pre><code><span class="token comment" spellcheck="true">//Permission Handler
</span><span class="token keyword" >var</span> users <span class="token operator" >=</span> <span class="token punctuation" >{</span>
    <span class="token string" >'paul'</span><span class="token punctuation" >:</span>  <span class="token punctuation" >{</span> pass<span class="token punctuation" >:</span> <span class="token string" >'abc'</span><span class="token punctuation" >,</span> group<span class="token punctuation" >:</span> <span class="token string" >'beatles'</span> <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
    <span class="token string" >'john'</span><span class="token punctuation" >:</span>  <span class="token punctuation" >{</span> pass<span class="token punctuation" >:</span> <span class="token string" >'def'</span><span class="token punctuation" >,</span> group<span class="token punctuation" >:</span> <span class="token string" >'beatles'</span> <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
    <span class="token string" >'keith'</span><span class="token punctuation" >:</span> <span class="token punctuation" >{</span> pass<span class="token punctuation" >:</span> <span class="token string" >'ghi'</span><span class="token punctuation" >,</span> group<span class="token punctuation" >:</span> <span class="token string" >'stones'</span> <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
    <span class="token string" >'mick'</span><span class="token punctuation" >:</span>  <span class="token punctuation" >{</span> pass<span class="token punctuation" >:</span> <span class="token string" >'jkl'</span><span class="token punctuation" >,</span> group<span class="token punctuation" >:</span> <span class="token string" >'stones'</span> <span class="token punctuation" >}</span>
<span class="token punctuation" >}</span><span class="token punctuation" >;</span>

server<span class="token punctuation" >.</span><span class="token keyword" >set</span><span class="token punctuation" >(</span> <span class="token string" >'permissionHandler'</span><span class="token punctuation" >,</span> <span class="token punctuation" >{</span>
    isValidUser<span class="token punctuation" >:</span> <span class="token keyword" >function</span><span class="token punctuation" >(</span> connectionData<span class="token punctuation" >,</span> authData<span class="token punctuation" >,</span> callback <span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
        <span class="token keyword" >if</span><span class="token punctuation" >(</span> users<span class="token punctuation" >[</span> authData<span class="token punctuation" >.</span>user <span class="token punctuation" >]</span><span class="token punctuation" >.</span>pass <span class="token operator" >===</span> authData<span class="token punctuation" >.</span>pass <span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
            <span class="token function" >callback<span class="token punctuation" >(</span></span> <span class="token keyword" >null</span><span class="token punctuation" >,</span> authData<span class="token punctuation" >.</span>user <span class="token punctuation" >)</span><span class="token punctuation" >;</span>
        <span class="token punctuation" >}</span> <span class="token keyword" >else</span> <span class="token punctuation" >{</span>
            <span class="token function" >callback<span class="token punctuation" >(</span></span> <span class="token string" >'Invalid Credentials'</span> <span class="token punctuation" >)</span><span class="token punctuation" >;</span>
        <span class="token punctuation" >}</span>
    <span class="token punctuation" >}</span><span class="token punctuation" >,</span>
    canPerformAction<span class="token punctuation" >:</span> <span class="token keyword" >function</span><span class="token punctuation" >(</span> username<span class="token punctuation" >,</span> message<span class="token punctuation" >,</span> callback <span class="token punctuation" >)</span> <span class="token punctuation" >{</span>
        <span class="token keyword" >var</span> recordName <span class="token operator" >=</span> message<span class="token punctuation" >.</span>data<span class="token punctuation" >[</span> <span class="token number" >0</span> <span class="token punctuation" >]</span><span class="token punctuation" >;</span>
        <span class="token keyword" >var</span> requestedGroup <span class="token operator" >=</span> recordName<span class="token punctuation" >.</span><span class="token function" >split<span class="token punctuation" >(</span></span> <span class="token string" >'-'</span> <span class="token punctuation" >)</span><span class="token punctuation" >[</span> <span class="token number" >0</span> <span class="token punctuation" >]</span><span class="token punctuation" >;</span>
        <span class="token keyword" >var</span> actualGroup <span class="token operator" >=</span> users<span class="token punctuation" >[</span> username <span class="token punctuation" >]</span><span class="token punctuation" >.</span>group<span class="token punctuation" >;</span>

        <span class="token function" >callback<span class="token punctuation" >(</span></span> <span class="token keyword" >null</span><span class="token punctuation" >,</span> requestedGroup <span class="token operator" >===</span> actualGroup <span class="token punctuation" >)</span><span class="token punctuation" >;</span>
    <span class="token punctuation" >}</span>
<span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
</code></pre><p>###Lists &amp; Anonymous Records
Deepstream has two other concepts that extend records: <a href="lists.html">Lists</a> and Anonymous Records.</p><p><a href="lists.html">Lists</a> are arrays of record names that come with a number of helper-methods like <code>addEntry</code> or <code>removeEntry</code>.</p><p>An Anonymous Record is a record without a predefined name. It
acts as a wrapper around an actual record that can be swapped out for another one whilst keeping all bindings intact.</p><p>###listening for record subscriptions made by other clients
deepstream allows you to register a callback function that will be notified whenever clients subscribe to a record for the first time. This is useful to create dynamic data providers that provide record content only on request.</p><pre><code><span class="token comment" spellcheck="true">//Browser Client
</span>ds<span class="token punctuation" >.</span>record<span class="token punctuation" >.</span><span class="token function" >getRecord<span class="token punctuation" >(</span></span> <span class="token string" >'stock/HXTO'</span> <span class="token punctuation" >)</span>
    <span class="token punctuation" >.</span><span class="token function" >subscribe<span class="token punctuation" >(</span></span><span class="token string" >'ask-price'</span><span class="token punctuation" >,</span> <span class="token keyword" >function</span><span class="token punctuation" >(</span> askPrice <span class="token punctuation" >)</span><span class="token punctuation" >{</span>
       <span class="token comment" spellcheck="true"> //Will be called every time the ask-price for HXTO changes
</span>    <span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token comment" spellcheck="true">
//Data Provider process on the backend that integrates deepstream with
</span><span class="token comment" spellcheck="true">//a stock data source
</span>ds<span class="token punctuation" >.</span>record<span class="token punctuation" >.</span><span class="token function" >listen<span class="token punctuation" >(</span></span> <span class="token string" >'stock/*'</span><span class="token punctuation" >,</span> <span class="token keyword" >function</span><span class="token punctuation" >(</span> recordName<span class="token punctuation" >,</span> isSubscribed <span class="token punctuation" >)</span><span class="token punctuation" >{</span>
    <span class="token keyword" >var</span> stockSymbol <span class="token operator" >=</span> recordName<span class="token punctuation" >.</span><span class="token function" >replace<span class="token punctuation" >(</span></span> <span class="token string" >'stock/'</span><span class="token punctuation" >,</span> <span class="token string" >''</span> <span class="token punctuation" >)</span><span class="token punctuation" >,</span>
        stockRecord <span class="token operator" >=</span> ds<span class="token punctuation" >.</span>record<span class="token punctuation" >.</span><span class="token function" >getRecord<span class="token punctuation" >(</span></span> recordName <span class="token punctuation" >)</span><span class="token punctuation" >;</span>

    stockDataSource<span class="token punctuation" >.</span><span class="token function" >getData<span class="token punctuation" >(</span></span> stockSymbol<span class="token punctuation" >.</span> <span class="token keyword" >function</span><span class="token punctuation" >(</span> stockData <span class="token punctuation" >)</span><span class="token punctuation" >{</span>
        stockRecord<span class="token punctuation" >.</span><span class="token keyword" >set</span><span class="token punctuation" >(</span> stockData <span class="token punctuation" >)</span><span class="token punctuation" >;</span>
    <span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
<span class="token punctuation" >}</span><span class="token punctuation" >)</span><span class="token punctuation" >;</span>
</code></pre>
			</div>
	</div>
	<div id="footer">
		<ul class="footer-items">

			<li class="footer-right">
				<ul class="social">
					<li class="twitter">
						<a href="https://twitter.com/deepstreamIO">
							<i class="fa fa-twitter"></i>  Twitter
						</a>
					</li>
					<li class="github">
						<a href="https://github.com/hoxton-one">
							<i class="fa fa-github"></i>  Github
						</a>
					</li>
					<li class="stack-overflow">
						<a href="http://stackoverflow.com/questions/tagged/deepstream.io">
							<i class="fa fa-stack-overflow"></i>  Stack Overflow
						</a>
					</li>
					<li>
						<a href="https://deepstream-slack.herokuapp.com/">
							<i class="fa fa-slack"></i>  Slack
						</a>
					</li>
				</ul>
			</li>

			<li class="footer-middle">
				<a class="footer-middle" href="http://www.hoxton-one.com/" title="hoxton-one.com">
					<p>
					Handcrafted by
					</p>

					<div class="footer-hoxton-one">
					</div>

					<div class="copyright">
						&copy;2015 Hoxton One Ltd. All rights reserved.
					</div>
				</a>
			</li>

			<li class="footer-left">
				<h4>Contact us</h4>
				<p>
					<b>deepstream.io </b>is developed by Hoxton One Ltd. <br>
				</p>
				<p>
					Email us <a href="mailto:info@hoxton-one.com">info@hoxton-one.com</a>.<br><br>
				</p>

				<h4>Star this project on github!</h4>
				<p>
					<a class="github-button" href="https://github.com/hoxton-one/deepstream.io" data-icon="octicon-star" data-style="mega" data-count-href="/hoxton-one/deepstream.io/stargazers" data-count-api="/repos/hoxton-one/deepstream.io#stargazers_count" data-count-aria-label="# stargazers on GitHub" aria-label="Star hoxton-one/deepstream.io on GitHub">Star</a>
				</p>
			</li>

		</ul>
	</div>


	<script async defer id="github-bjs" src="https://buttons.github.io/buttons.js"></script>
</body>
</html>
